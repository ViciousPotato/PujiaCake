extends cart

block title
  确认信息

block content
  style
    .lheader {
      font-size: 13px;
      margin-top: 15px;
    }

    .checkout-item {
      margin-bottom: 15px;
      position: relative;
      border: 1px solid #F71833;
      padding: 5px;
      background-color: rgb(255, 249, 237)
    }

    .checkout-item-title {
      display: block;
      width: 90px;
      position: absolute;
      left: 0;
      top: 0;
      padding-top: 17px;
      padding-left: 10px;
      /*background-color: #FB7E8D;*/
      background-clip: border-box;
      z-index: auto
    }

    .checkout-item-content {
      display: block;
      margin-left: 120px;
      position: relative;
    }

    .checkout-name {
      width: 90px;
      position: absolute;
      left: 0;
    }

    .checkout-detail {
      margin-left: 120px;
    }

    .new-address-form label {
      width: 50px;
      display: block;
    }
    
    .radio {
      margin-right: 5px;
    }
    
    .express-choice {
      margin-top: 5px;
      margin-bottom: 5px;
    }

    .checkout-item-content div {
      margin-top: 5px;
      margin-bottom: 5px;
    }

    .address-detail div {
      margin-top: 5px;
    }
  
  form(action='/cart/confirm-order', method='post')
    .checkout-item
      .checkout-item-title
        h5 送货信息
      .checkout-item-content
        - each address in user.addresses
          .checkout-name
            input.radio.address-radio(
              type="radio", 
              name="address", 
              value="#{address._id}",
              id="#{address.province}")
            | #{address.name}
          .checkout-detail.address-detail
            div #{address.province}, #{address.city}, #{address.address}，邮编:#{address.zipCode}
            div 收货人#{address.name}
            div 联系电话 #{address.phone}
    
        a(href="/member/address") 送货信息管理

    .checkout-item
      .checkout-item-title
        h5 送货方式
      .checkout-item-content
        .express-choice
          input#sf-radio.radio(type="radio", name="express", value="sf")
          | 顺丰
        .express-choice
          input#other-radio.radio(type="radio", name="express", value="others")
          | 其它快递
  
    .checkout-item
      .checkout-item-title
        h5 费用清单
      .checkout-item-content
        div(style="padding-left: 0;") 
          | 商品费用 
          span.price ￥#{amount}
        div(style="padding-left: 0;")
          | 快递费用
          span#express-fee.price
        div(style="padding-left: 0")
          | 总重
          span.price #{weight/1000}kg
  
    .checkout-item(style="padding-top: 10px; padding-bottom: 10px;")
      .checkout-item-title
        h5 支付方式
      .checkout-item-content
        img(src="http://img3.douban.com/ark/pics/logo-alipay.png?v=2969123089")

    input.submit-button(type='submit', value='提交订单')
    
  script
    function updateExpressFee() {
      var province = $('.address-radio[checked]').attr('id');
      var expressFee = $.grep(fees, function(f) {
        if (f.province == province) return true;
        return false;
      })[0];
      
      if ($('#sf-radio').attr('checked')) {
        $('#express-fee').text('￥' + expressFee.sfFee);
      } else {
        $('#express-fee').text('￥' + expressFee.otherFee);
      }
    }
    
    var fees = !{JSON.stringify(fees)};
    $('.address-radio').first().attr('checked', true);
    $('#sf-radio').attr('checked', true);
    updateExpressFee();
    
    $('.address-radio').on('change', updateExpressFee);
    $('#sf-radio').on('change', updateExpressFee);
    $('#other-radio').on('change', updateExpressFee);

